@using PersonalSite.Models
@using PersonalSite.Markdown

@{
    var experience = Model.experience;

    var now = ExperienceExtensions.GetNowDate();

    var startDate = experience.GetStartDate();
    DateTime? endDate = experience.GetEndDate();
}

@if(Model.isSub) 
{
    <p>@experience.EmploymentType</p>
}
else 
{
    <p>@experience.Company • @experience.EmploymentType</p>
}

<p class="text-muted meta">@startDate.Humanize(endDate) • @startDate.Humanize2(endDate)<br />@experience.Location</p>

@if(ShowMore) 
{
    <div class="mb-4">
        <MarkdownView Content="@experience.Description" />
    </div>
    
    @if(experience.Skills?.Any() ?? false)
    {
        <dl class="mt-5 pb-6">
            <dt>Skills</dt>
            <dd>
                @foreach (var skillName in experience.Skills)
                {
                    <a class="badge rounded-pill bg-secondary me-1 mb-1 text-decoration-none">
                        @skillName
                    </a>
                }
            </dd>
        </dl>
    }
    <div class="mt-5">
        <small><a href="#" @onclick="ToggleShowMore" @onclick:preventDefault><i class="fa fa-chevron-up me-1"></i> Show less</a></small>
    </div>
}
else 
{
   var breakIndex = experience.Description.IndexOf(".");
   if(breakIndex == -1)
   {
       breakIndex = experience.Description.IndexOf("\n");
   }
   var content = breakIndex == -1 ? experience.Description : experience.Description.Substring(0, breakIndex + 1);

    <div class="mb-4">
        <MarkdownView Content="@content" />
   </div>

    <div class="mt-5">
        <small><a href="#" @onclick="ToggleShowMore" @onclick:preventDefault><i class="fa fa-chevron-down me-1"></i> Show more</a></small>
    </div>
}

@code {
    [Parameter]
    public bool ShowMore { get; set; }

    [Parameter]
    [EditorRequired]
    public Obj Model { get; set; }

    void ToggleShowMore() 
    {
        ShowMore = !ShowMore;

        StateHasChanged();
    }
}